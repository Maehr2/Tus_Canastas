{% load static %}
<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Editar producto — Admin</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    /* Pequeño estilo para mensaje "lindo" */
    .msg-lindo {
      border-left: 4px solid #28a745;
      background: linear-gradient(90deg, rgba(40,167,69,0.06), rgba(255,255,255,0));
      padding: .8rem 1rem;
      border-radius: .45rem;
    }
  </style>
</head>
<body class="bg-light">
  <main class="container py-4">
    <div class="d-flex justify-content-between align-items-center mb-3">
      <h4>Editar producto: {{ producto.nombre }}</h4>
      <a href="{% url 'revisar_productos' %}" class="btn btn-outline-secondary">Volver</a>
    </div>

    {# Mensajes: mostrarlos con estilo y autocierre #}
    {% if messages %}
      <div class="mb-3">
        {% for m in messages %}
          <div class="alert alert-{{ m.tags|default:'info' }} alert-dismissible fade show rounded" role="alert">
            {% if 'success' in m.tags %}
              ✅
            {% elif 'error' in m.tags or 'danger' in m.tags %}
              ❌
            {% endif %}
            <strong class="ms-1">{{ m }}</strong>
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Cerrar"></button>
          </div>
        {% endfor %}
      </div>
    {% endif %}

    <div class="card">
      <div class="card-body">
        <form method="post" novalidate>
          {% csrf_token %}
          {{ form.non_field_errors }}

          <div class="mb-2">
            <label class="form-label">Nombre</label>
            {{ form.nombre }}
            {% if form.nombre.errors %}<div class="text-danger small">{{ form.nombre.errors }}</div>{% endif %}
          </div>

          <div class="mb-2">
            <label class="form-label">Marca</label>
            {{ form.marca }}
          </div>

          <div class="mb-2">
            <label class="form-label">Tipo</label>
            {{ form.tipo }}
          </div>

          {# Precio + moneda: incluímos un hidden input para moneda para que llegue en el POST #}
          <div class="mb-2">
            <label class="form-label">Precio</label>
            <div class="input-group">
              {{ form.precio }}
              {# fallback: toma form.moneda.value, si no existe toma producto.moneda, si no CLP #}
              {% with moneda=form.moneda.value|default:producto.moneda|default:"CLP" %}
                <input type="hidden" name="moneda" value="{{ moneda }}">
                <span class="input-group-text">{{ moneda }}</span>
              {% endwith %}
            </div>
            {% if form.precio.errors %}<div class="text-danger small">{{ form.precio.errors }}</div>{% endif %}
          </div>

          <div class="mb-2">
            <label class="form-label">Imagen URL</label>
            {{ form.imagen_url }}
          </div>

          <div class="mb-2">
            <label class="form-label">URL producto</label>
            {{ form.producto_url }}
          </div>

          <div class="d-flex justify-content-end mt-3">
            <button class="btn btn-primary" type="submit">Guardar cambios</button>
          </div>
        </form>
      </div>
    </div>

  </main>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

  <script>
    // autocerrar alerts después de 3s y pequeña animación
    document.addEventListener('DOMContentLoaded', () => {
      const alerts = document.querySelectorAll('.alert');
      alerts.forEach(a => {
        setTimeout(() => {
          try {
            // usa bootstrap dismiss si existe
            const bsAlert = bootstrap.Alert.getOrCreateInstance(a);
            bsAlert.close();
          } catch(e) { a.style.display = 'none'; }
        }, 3000);
      });
    });
  </script>
</body>
</html>
